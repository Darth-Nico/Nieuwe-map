<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spud Siege | Tower Defense</title>
    <style>
        @font-face {
            font-family: 'PixelFont';
            src: url('https://cdn.jsdelivr.net/npm/@fontsource/vcr-osd-mono@4.5.0/files/vcr-osd-mono-latin-400-normal.woff2') format('woff2');
        }

        body {
            margin: 0;
            padding: 0;
            background: #1a0f0f;
            font-family: 'PixelFont', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .interactive-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .color-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
            transition: all 0.5s ease-out;
            mix-blend-mode: soft-light;
            opacity: 0.6;
            background: #8B4513;
        }

        .orb1 {
            width: 600px;
            height: 600px;
            background: #8B4513;
        }

        .orb2 {
            width: 500px;
            height: 500px;
            background: #A0522D;
        }

        .orb3 {
            width: 400px;
            height: 400px;
            background: #6B4423;
        }

        .game-container {
            text-align: center;
            background: rgba(20, 10, 5, 0.85);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border: 4px solid rgba(139, 69, 19, 0.3);
            box-shadow: 
                0 0 30px rgba(139, 69, 19, 0.2),
                inset 0 0 20px rgba(139, 69, 19, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 15px;
        }

        .title {
            color: #FFD700;
            font-size: 4rem;
            text-shadow: 
                4px 4px 0 #000,
                -2px -2px 0 #8B4513;
            margin-bottom: 3rem;
            letter-spacing: 4px;
            font-family: 'PixelFont', monospace;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin: 2rem 0;
            width: 100%;
            max-width: 300px;
        }

        .menu-button {
            background-color: #8B4513;
            color: #FFD700;
            border: 3px solid #000;
            padding: 1rem 2rem;
            margin: 0.5rem 0;
            font-size: 1.5rem;
            font-family: 'PixelFont', monospace;
            box-shadow: 
                3px 3px 0 #000,
                -3px -3px 0 #B8860B;
            image-rendering: pixelated;
            cursor: pointer;
            transition: all 0.1s ease;
            width: 100%;
            min-width: 250px;
            text-align: center;
            display: block;         /* Voeg dit toe */
            margin-left: auto;      /* Voeg dit toe */
            margin-right: auto;     /* Voeg dit toe */
        }

        .menu-button:hover {
            background-color: #A0522D;
            transform: translate(2px, 2px);
            box-shadow: 
                1px 1px 0 #000,
                -1px -1px 0 #B8860B;
        }

        .menu-button:active {
            transform: translate(4px, 4px);
            box-shadow: none;
        }

        .potato-decoration {
            width: 120px;
            height: auto;
            margin: 1rem;
            image-rendering: pixelated;
            /* Pixel art rotatie animatie */
            animation: pixel-bounce 2s infinite;
        }

        @keyframes pixel-bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #2c1810;
            padding: 2rem;
            border: 4px solid #8B4513;
            box-shadow: 
                4px 4px 0 #000,
                -4px -4px 0 #B8860B;
            text-align: center;
            max-width: 400px;
            position: relative;
            font-family: 'PixelFont', monospace;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #FFD700;
            font-size: 2rem;
            cursor: pointer;
            font-family: 'PixelFont', monospace;
        }

        .settings-option {
            margin: 1.5rem 0;
            color: #FFD700;
            font-size: 1.2rem;
            font-family: 'PixelFont', monospace;
        }

        .github-link {
            color: #FFD700;
            text-decoration: none;
            font-size: 0.8rem;
            margin: 1rem 0;
            display: block;
        }

        .credits {
            color: #FFD700;
            font-size: 0.8rem;
            margin-top: 1.5rem;
        }

        .toggle-button {
            background-color: #8B4513;
            color: #FFD700;
            border: 2px solid #000;
            padding: 0.5rem 1rem;
            margin-left: 1rem;
            font-family: 'PixelFont', monospace;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .toggle-button:hover {
            background-color: #A0522D;
        }

        .game-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #87CEEB;
            z-index: 100;
        }

        /* Update de game-map styling */
        .game-map {
            position: relative;
            width: 100%;
            height: 100vh;
            background-color: #90EE90;
            background-image: 
                linear-gradient(45deg, #82E082 25%, transparent 25%),
                linear-gradient(-45deg, #82E082 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #82E082 75%),
                linear-gradient(-45deg, transparent 75%, #82E082 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            border: none;
            animation: grassWave 8s ease-in-out infinite;
        }

        @keyframes grassWave {
            0%, 100% { background-position: 0 0, 0 10px, 10px -10px, -10px 0px; }
            50% { background-position: 2px 2px, 2px 12px, 12px -8px, -8px 2px; }
        }

        /* Update de path styling */
        .path {
            position: absolute;
            background-color: #808080;
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.2) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.2) 1px, transparent 1px),
                linear-gradient(rgba(255, 255, 255, 0.1) 0.5px, transparent 0.5px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.1) 0.5px, transparent 0.5px),
                repeating-linear-gradient(
                    -45deg,
                    #707070 0px,
                    #707070 2px,
                    #808080 2px,
                    #808080 20px
                );
            background-size: 30px 30px, 30px 30px, 30px 30px, 30px 30px, 40px 40px;
            border: 3px solid #606060;
            box-shadow: 
                inset 0 2px 5px rgba(0, 0, 0, 0.3),
                inset 0 -2px 5px rgba(255, 255, 255, 0.1);
        }

        .path.vertical {
            width: 60px;
        }

        .path.horizontal {
            height: 60px;
        }

        .path-curve {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: #808080;
            background-image: 
                radial-gradient(circle at center, #707070 30%, transparent 30%),
                repeating-conic-gradient(
                    from 0deg,
                    #808080 0deg 30deg,
                    #707070 30deg 60deg
                );
            border: 3px solid #606060;
            box-shadow: 
                inset 0 2px 5px rgba(0, 0, 0, 0.3),
                inset 0 -2px 5px rgba(255, 255, 255, 0.1);
        }

        .path-curve::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(45deg, transparent 45%, rgba(0, 0, 0, 0.1) 45%, rgba(0, 0, 0, 0.1) 55%, transparent 55%),
                linear-gradient(-45deg, transparent 45%, rgba(0, 0, 0, 0.1) 45%, rgba(0, 0, 0, 0.1) 55%, transparent 55%);
            background-size: 20px 20px;
            pointer-events: none;
        }

        .path::after, .path-curve::after {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, 
                rgba(0, 0, 0, 0.2) 0%, 
                transparent 50%, 
                rgba(255, 255, 255, 0.1) 100%
            );
            pointer-events: none;
            z-index: 1;
        }

        .game-map {
            animation: grassWave 8s ease-in-out infinite;
        }

        .king-position {
            position: absolute;
            top: 10%;
            left: 65%;
            transform: translateX(-50%);
            z-index: 102;
        }

        .king-position img {
            width: 80px;
            height: auto;
            image-rendering: pixelated;
        }

        .game-ui {
            position: fixed;
            right: 20px;
            top: 20px;
            background-color: rgba(44, 24, 16, 0.9);
            padding: 1rem;
            border: 4px solid #8B4513;
            box-shadow: 4px 4px 0 #000;
            z-index: 101;
        }

        .wave-button {
            background-color: #8B4513;
            color: #FFD700;
            border: 3px solid #000;
            padding: 0.5rem 1rem;
            font-family: 'PixelFont', monospace;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.1s ease;
        }

        .wave-button:hover {
            background-color: #A0522D;
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #000;
        }

        .wave-button:active {
            transform: translate(4px, 4px);
            box-shadow: none;
        }

        .enemy {
            position: absolute !important;
            width: 40px;
            height: 40px;
            z-index: 101;
            left: 10%;
            bottom: 0;
        }

        .enemy img {
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
        }

        @keyframes followPath {
            0% {
                left: 10%;
                bottom: 0;
            }
            30% {
                left: 10%;
                bottom: 30%;
            }
            45% {
                left: 40%;
                bottom: 30%;
            }
            60% {
                left: 40%;
                bottom: 60%;
            }
            75% {
                left: 70%;
                bottom: 60%;
            }
            100% {
                left: 70%;
                bottom: 100%;
            }
        }

        .wave-button.disabled {
            background-color: #5a361b;
            color: #998200;
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
            box-shadow: none;
        }

        .wave-button.disabled:hover {
            background-color: #5a361b;
            transform: none;
            box-shadow: none;
        }

        /* Update de shop-toggle CSS */
        .shop-toggle {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background-color: #8B4513;
            color: #FFD700;
            border: none;
            padding: 1rem 0.5rem;
            cursor: pointer;
            border-radius: 5px 0 0 5px;
            border: 3px solid #000;
            border-right: none;
            z-index: 102;
            display: none; /* Verberg de button standaard */
            transition: right 0.3s ease;
        }

        .shop-toggle:hover {
            background-color: #A0522D;
        }

        .shop-sidebar {
            position: fixed;
            right: -300px;
            top: 0;
            width: 300px;
            height: 100%;
            background-color: rgba(44, 24, 16, 0.95);
            border-left: 4px solid #8B4513;
            padding: 1rem;
            transition: right 0.3s ease;
            z-index: 101;
            visibility: hidden;
        }

        .shop-sidebar.open {
            right: 0;
            visibility: visible;
        }

        .shop-item {
            background-color: #5a5a5a;
            border: 3px solid #000;
            padding: 1rem;
            margin: 1rem 0;
            color: #FFD700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-family: 'PixelFont', monospace;
            font-size: 1.2rem;
        }

        .shop-item:hover {
            background-color: #6a6a6a;
        }

        .shop-item.selected {
            background-color: #7a7a7a;
            border-color: #FFD700;
        }

        .cannon-preview {
            display: none;
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: rgba(90, 90, 90, 0.5);
            border-radius: 50%;
            pointer-events: none;
            z-index: 103;
        }

        .cannon-preview.invalid {
            background-color: rgba(231, 76, 60, 0.5);
            border: 2px solid rgba(231, 76, 60, 0.8);
        }

        /* Update de bestaande cannon-radius class */
        .cannon-radius {
            position: absolute;
            width: var(--radius-size); /* Dynamische radius grootte */
            height: var(--radius-size); /* Dynamische radius grootte */
            background-color: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .cannon-barrel {
            position: absolute;
            width: 12px;
            height: 6px;
            background-color: #404040;
            top: 50%;
            left: 100%;
            transform-origin: left center;
            transform: translateY(-50%);
        }

        .bullet {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #FFD700;
            border-radius: 50%;
            z-index: 101;
        }

        @keyframes shoot {
            to {
                transform: translate(var(--targetX), var(--targetY));
                opacity: 0;
            }
        }

        .placed-cannon {
            position: absolute;
            width: 40px !important;
            height: 20px !important;
            margin: 0 !important;
            padding: 0 !important;
            background: linear-gradient(to bottom, #707070, #505050) !important;
            border: 2px solid #000 !important;
            z-index: 102;
            transform-origin: center center;
        }

        @keyframes recoil {
            0% { transform: translateX(0) rotate(var(--rotation)); }
            20% { transform: translateX(-4px) rotate(var(--rotation)); }
            100% { transform: translateX(0) rotate(var(--rotation)); }
        }

        @keyframes flash {
            0% { 
                opacity: 1;
                transform: scale(1);
            }
            100% { 
                opacity: 0;
                transform: scale(2);
            }
        }

        .muzzle-flash {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: #FFD700;
            border-radius: 50%;
            left: 100%;
            top: 50%;
            transform: translate(0, -50%);
            opacity: 0;
            pointer-events: none;
        }

        .placed-cannon.shooting {
            animation: recoil 0.2s ease-out;
        }

        .hp-bar {
            position: absolute;
            width: 40px;
            height: 4px;
            background-color: #333;
            border: 1px solid #000;
            top: -8px;
            left: 0;
        }

        /* Voeg deze CSS toe voor de HP bar animaties */
        .hp-fill {
            height: 100%;
            background-color: #2ecc71;
            transition: width 0.2s ease-out;
        }

        .enemy .hp-fill {
            transition: width calc(0.2s + var(--hp-transition-delay, 0s)) ease-out;
        }

        .king-hp-bar {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 6px;
            background-color: #333;
            border: 1px solid #000;
        }

        .king-hp-fill {
            height: 100%;
            background-color: #2ecc71;
            transition: width 0.2s ease;
        }

        .enemy {
            position: relative;
        }

        .tooltip {
            position: fixed;
            background-color: rgba(44, 24, 16, 0.95);
            border: 2px solid #8B4513;
            padding: 1rem;
            border-radius: 5px;
            color: #FFD700;
            font-size: 1rem;
            pointer-events: none;
            z-index: 1000;
            min-width: 200px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            font-family: 'PixelFont', monospace;
        }

        .tooltip-stat {
            display: flex;
            justify-content: space-between;
            margin: 0.3rem 0;
        }

        .tooltip-title {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid #FFD700;
            padding-bottom: 0.3rem;
        }

        .shop-item.disabled {
            opacity: 0.5;
            filter: grayscale(100%);
            cursor: not-allowed;
            pointer-events: none;
            background: #5a5a5a !important; /* Override andere background colors */
            border-color: #444 !important;
        }

        .shop-item.disabled:hover {
            transform: none;
            background-color: #5a5a5a !important;
        }

        /* Voor de healing knop specifiek */
        .shop-item.healing.disabled {
            background: linear-gradient(to right, #5a5a5a, #5a5a5a) !important;
        }

        /* Voor de boost knop specifiek */
        .shop-item.boost.disabled {
            background: linear-gradient(to right, #5a5a5a, #5a5a5a) !important;
        }

        .broken-cannon {
            position: absolute;
            width: 40px;
            height: 20px;
            background: linear-gradient(to bottom, #505050, #303030);
            border: 2px solid #000;
            cursor: pointer;
            z-index: 102;
            filter: brightness(0.7);
        }

        .broken-cannon::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(45deg, transparent 45%, #000 45%, #000 55%, transparent 55%),
                linear-gradient(-45deg, transparent 45%, #000 45%, #000 55%, transparent 55%);
        }

        .broken-cannon::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 6px;
            background-color: #202020;
            top: 50%;
            left: 100%;
            transform: translateY(-50%);
            border: 1px solid #000;
        }

        .broken-cannon:hover {
            filter: brightness(0.9);
        }

        @keyframes break-apart {
            0% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1.2) rotate(5deg);
                opacity: 0.8;
            }
            100% { 
                transform: scale(1) rotate(10deg);
                opacity: 0.7;
            }
        }

        .broken-cannon {
            animation: break-apart 0.3s ease-out forwards;
        }

        .tutorial-step {
            position: fixed;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(44, 24, 16, 0.95);
            border: 2px solid #8B4513;
            padding: 1rem;
            border-radius: 5px;
            color: #FFD700;
            font-size: 0.8rem;
            pointer-events: none;
            z-index: 1000;
            min-width: 200px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .tutorial-step.active {
            display: block;
        }

        .tutorial-highlight {
            background-color: rgba(255, 255, 0, 0.2);
            border: 2px dashed #FFD700;
            border-radius: 5px;
            pointer-events: none;
        }

        /* Update de warning-tooltip CSS */
        .warning-tooltip {
            position: fixed;
            background-color: rgba(231, 76, 60, 0.95);
            border: 2px solid #c0392b;
            padding: 0.8rem;
            border-radius: 5px;
            color: #fff;
            font-size: 0.8rem;
            pointer-events: none;
            z-index: 1000;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            animation: fade-in 0.3s ease-out;
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .placed-double-cannon {
            position: absolute;
            width: 40px !important;
            height: 20px !important;
            margin: 0 !important;
            padding: 0 !important;
            background: linear-gradient(to bottom, #606060, #404040) !important;
            border: 2px solid #000 !important;
            z-index: 102;
            transform-origin: center center;
        }

        .double-cannon-barrel {
            position: absolute;
            width: 12px;
            height: 4px;
            background-color: #303030;
            border: 1px solid #000;
        }

        .double-cannon-barrel.top {
            top: 30%;
            left: 100%;
            transform: translateY(-50%);
        }

        .double-cannon-barrel.bottom {
            top: 70%;
            left: 100%;
            transform: translateY(-50%);
        }

        .broken-double-cannon {
            position: absolute;
            width: 40px;
            height: 20px;
            background: linear-gradient(to bottom, #404040, #202020);
            border: 2px solid #000;
            cursor: pointer;
            z-index: 102;
            filter: brightness(0.7);
        }

        .broken-double-cannon::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(45deg, transparent 45%, #000 45%, #000 55%, transparent 55%),
                linear-gradient(-45deg, transparent 45%, #000 45%, #000 55%, transparent 55%);
        }

        .broken-double-cannon::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .broken-double-cannon .broken-barrel {
            position: absolute;
            width: 12px;
            height: 4px;
            background-color: #202020;
            border: 1px solid #000;
            left: 100%;
        }

        .broken-double-cannon .broken-barrel.top {
            top: 30%;
            transform: translateY(-50%) rotate(5deg);
        }

        .broken-double-cannon .broken-barrel.bottom {
            top: 70%;
            transform: translateY(-50%) rotate(-5deg);
        }

        /* Update de CSS voor de range indicator */
        .cannon-preview .range-indicator {
            position: absolute;
            width: 200px;
            height: 200px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 101;
        }

        /* Voeg een rode versie toe voor ongeldige plaatsing */
        .cannon-preview.invalid .range-indicator {
            background-color: rgba(231, 76, 60, 0.1);
            border-color: rgba(231, 76, 60, 0.3);
        }

        /* Voeg deze CSS styles toe */
        .shop-category {
            color: #FFD700;
            font-size: 1.2rem;
            margin: 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #8B4513;
        }

        .shop-item.healing {
            background: linear-gradient(to right, #5a5a5a, #2ecc71);
        }

        .shop-item.healing:hover {
            background: linear-gradient(to right, #6a6a6a, #27ae60);
        }

        .shop-item.disabled {
            opacity: 0.5;
            filter: grayscale(100%);
            cursor: not-allowed;
            pointer-events: none;
            background: #5a5a5a !important; /* Override andere background colors */
            border-color: #444 !important;
        }

        .shop-item.disabled:hover {
            transform: none;
            background-color: #5a5a5a !important;
        }

        /* Voor de healing knop specifiek */
        .shop-item.healing.disabled {
            background: linear-gradient(to right, #5a5a5a, #5a5a5a) !important;
        }

        /* Voor de boost knop specifiek */
        .shop-item.boost.disabled {
            background: linear-gradient(to right, #5a5a5a, #5a5a5a) !important;
        }

        /* Voeg deze CSS toe */
        .bonus-coin-button {
            position: fixed;
            left: 20px;
            top: 20px;
            background-color: rgba(44, 24, 16, 0.9);
            border: 4px solid #8B4513;
            box-shadow: 4px 4px 0 #000;
            padding: 0.8rem;
            cursor: pointer;
            display: none;
            align-items: center;
            gap: 0.8rem;
            z-index: 101;
            transition: transform 0.1s ease, opacity 0.3s ease;
            min-width: 200px;
        }

        .bonus-text {
            color: #FFD700;
            font-family: 'PixelFont', monospace;
            font-size: 0.9rem;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.2rem;
        }

        .bonus-title {
            font-size: 1rem;
            color: #FFD700;
        }

        .bonus-subtitle {
            font-size: 0.7rem;
            color: #FFA500;
            opacity: 0.8;
        }

        /* Voeg deze nieuwe CSS toe voor de disabled state */
        .bonus-coin-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(100%);
            transform: none;
        }

        .bonus-coin-button.disabled:hover {
            transform: none;
        }

        .bonus-coin-button:hover:not(.disabled) {
            transform: scale(1.05);
        }

        .bonus-coin-button img {
            width: 24px;
            height: 24px;
        }

        .bonus-coin-button span {
            color: #FFD700;
            font-size: 1.2rem;
        }

        .trivia-modal .modal-content {
            max-width: 500px;
            text-align: left;
        }

        .trivia-question {
            color: #FFD700;
            font-size: 1rem;
            margin: 1rem 0;
            line-height: 1.4;
        }

        .trivia-answers {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin: 1.5rem 0;
        }

        .answer-button {
            background-color: #8B4513;
            color: #FFD700;
            border: 3px solid #000;
            padding: 0.8rem;
            font-family: 'PixelFont', monospace;
            font-size: 1rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.1s ease;
        }

        .answer-button:hover {
            background-color: #A0522D;
            transform: translateX(4px);
        }

        .answer-button.correct {
            background-color: #2ecc71;
            color: #fff;
        }

        .answer-button.incorrect {
            background-color: #e74c3c;
            color: #fff;
        }

        .shop-item.boost {
            background: linear-gradient(to right, #5a5a5a, #9b59b6);
        }

        .shop-item.boost:hover {
            background: linear-gradient(to right, #6a6a6a, #8e44ad);
        }

        /* Voeg deze CSS toe voor de boost animatie */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.6; }
            100% { transform: scale(2); opacity: 0; }
        }

        /* Voeg deze CSS toe voor de numerieke waardes */
        .hp-numbers {
            position: absolute;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 10px;
            font-family: 'PixelFont', monospace;
            text-shadow: 1px 1px 1px #000;
            pointer-events: none;
            z-index: 1;
        }

        .king-hp-numbers {
            position: absolute;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 12px;
            font-family: 'PixelFont', monospace;
            text-shadow: 1px 1px 1px #000;
            top: -20px;
        }

        /* Voeg deze CSS toe voor de coin icon */
        .coin-icon {
            width: 16px;
            height: 16px;
            vertical-align: middle;
            image-rendering: pixelated;
            margin: 0; /* Verwijder alle margins */
        }

        /* Update de shop item styling */
        .shop-item > div > div:last-child {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 4px; /* Ruimte tussen prijs en coin icon */
        }

        /* Voeg deze CSS toe bij de andere animaties */
        @keyframes explosion {
            0% {
                transform: scale(0.1);
                opacity: 1;
                background: #FFD700;
            }
            35% {
                transform: scale(1);
                opacity: 0.9;
                background: #FF8C00;
            }
            70% {
                transform: scale(1.2);
                opacity: 0.5;
                background: #FF4500;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
                background: #8B0000;
            }
        }

        .explosion-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 103;
        }

        @keyframes debris {
            0% {
                transform: translate(0, 0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) rotate(var(--rotation));
                opacity: 0;
            }
        }

        .debris {
            position: absolute;
            width: 6px;
            height: 3px;
            background: #404040;
            border: 1px solid #000;
            pointer-events: none;
            z-index: 103;
        }
    </style>
</head>
<body>
    <div id="gameOverModal" class="modal">
        <div class="modal-content">
            <h2 class="title" style="font-size: 1.5rem; color: #e74c3c;">Game Over!</h2>
            <div style="color: #FFD700; margin: 1rem 0; text-align: center; font-size: 0.9rem;">
                De koning is verslagen!
            </div>
            <button class="menu-button" onclick="backToMenu()">Menu</button>
        </div>
    </div>
    <div class="interactive-bg">
        <div class="color-orb orb1"></div>
        <div class="color-orb orb2"></div>
        <div class="color-orb orb3"></div>
    </div>
    <div class="game-container">
        <h1 class="title">Spud Siege</h1>
        <div class="menu-buttons">
            <button class="menu-button" onclick="startGame()">Start Spel</button>
            <button class="menu-button" onclick="showInstructions()">Instructies</button>
            <button class="menu-button" onclick="showSettings()">Instellingen</button>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <button class="close-button" onclick="closeSettings()">×</button>
            <h2 class="title" style="font-size: 1.5rem;">Instellingen</h2>
            
            <div class="settings-option">
                Geluid: <button class="toggle-button" onclick="toggleSound()" id="soundButton">AAN</button>
            </div>

            <a href="https://github.com/darth-nico" target="_blank" class="github-link">
                github.com/darth-nico
            </a>

            <div class="credits">
                Credits: Niels Coert
            </div>
        </div>
    </div>

    <div id="gameView" class="game-view">
        <div class="game-map">
            <!-- Zigzag pad van linksonder naar rechtsboven -->
            <div class="path vertical" style="left: 10%; bottom: 0; height: 30%;"></div>
            <div class="path-curve" style="left: 10%; bottom: 30%;"></div>
            <div class="path horizontal" style="left: 10%; bottom: 30%; width: 30%;"></div>
            <div class="path-curve" style="left: 40%; bottom: 30%;"></div>
            <div class="path vertical" style="left: 40%; bottom: 30%; height: 30%;"></div>
            <div class="path-curve" style="left: 40%; bottom: 60%;"></div>
            <div class="path horizontal" style="left: 40%; bottom: 60%; width: 30%;"></div>
            <div class="path-curve" style="left: 70%; bottom: 60%;"></div>
            <div class="path vertical" style="left: 70%; bottom: 60%; height: 60%;"></div>
            
            <!-- Koning positie -->
            <div class="king-position" style="top: 10%; left: 65%;">
                <div class="king-hp-bar">
                    <div class="king-hp-fill" style="width: 100%;"></div>
                </div>
                <img src="assets/patato-king.png" alt="Koning">
            </div>
        </div>

        <!-- Game UI -->
        <div class="game-ui">
            <div class="coin-display" style="color: #FFD700; margin-bottom: 1rem; font-size: 1.5rem;">
                <span id="coinDisplay">200</span> 
                <img src="assets/coin.png" alt="coins" class="coin-icon">
            </div>
            <div class="wave-info" style="color: #FFD700; margin-bottom: 1rem; font-size: 1.2rem;">
                Wave: <span id="waveNumber">1</span>
                <div id="waveStatus" style="margin-top: 0.5rem; font-size: 0.7rem;">Klaar om te starten</div>
            </div>
            <button class="wave-button" onclick="startWave()">Start Wave</button>
        </div>
    </div>

    <div id="waveCompletionModal" class="modal">
        <div class="modal-content">
            <h2 class="title" style="font-size: 1.5rem;">Wave <span id="completedWaveNumber">1</span> Voltooid!</h2>
            <div class="wave-stats" style="color: #FFD700; margin: 1rem 0; text-align: left; font-size: 0.8rem;">
                <div>Vijanden verslagen: <span id="enemiesDefeatedStat">0</span></div>
                <div>Vijanden doorgekomen: <span id="enemiesLeakedStat">0</span></div>
                <div>Koning HP: <span id="kingHealthStat">100</span>/100</div>
                <div>Verdiend: <span id="coinsEarnedStat">0</span> <img src="assets/coin.png" alt="coins" class="coin-icon"></div>
                <div>Wave bonus: <span id="waveBonusStat">50</span> <img src="assets/coin.png" alt="coins" class="coin-icon"></div>
            </div>
            <button class="menu-button" style="margin-top: 1rem;" onclick="closeWaveCompletion()">Doorgaan</button>
        </div>
    </div>

    <button class="shop-toggle" onclick="toggleShop()">◀</button>
    <div class="shop-sidebar">
        <h2 style="color: #FFD700; font-size: 1.2rem; margin-bottom: 2rem;">Shop</h2>
        
        <!-- Bestaande kanonnen sectie -->
        <div class="shop-category">Verdediging</div>
        <div class="shop-item" onclick="selectCannon('single')">
            <div style="width: 40px; height: 20px; background-color: #606060; position: relative; border: 2px solid #000; box-shadow: 0 0 0 2px #FFD700; background: linear-gradient(to bottom, #707070, #505050);">
                <div style="position: absolute; width: 12px; height: 6px; background-color: #404040; top: 50%; left: 100%; transform: translateY(-50%); border: 1px solid #000;"></div>
            </div>
            <div>
                <div>Kanon</div>
                <div style="font-size: 0.8rem; display: flex; align-items: center;">50 <img src="assets/coin.png" alt="coins" class="coin-icon"></div>
            </div>
        </div>
        
        <div class="shop-item" onclick="selectCannon('double')" style="margin-top: 1rem;">
            <div style="width: 40px; height: 20px; background-color: #4a4a4a; position: relative; border: 2px solid #000; box-shadow: 0 0 0 2px #FFD700; background: linear-gradient(to bottom, #606060, #404040);">
                <div style="position: absolute; width: 12px; height: 4px; background-color: #303030; top: 30%; left: 100%; transform: translateY(-50%); border: 1px solid #000;"></div>
                <div style="position: absolute; width: 12px; height: 4px; background-color: #303030; top: 70%; left: 100%; transform: translateY(-50%); border: 1px solid #000;"></div>
            </div>
            <div>
                <div>Dubbel Kanon</div>
                <div style="font-size: 0.8rem; display: flex; align-items: center;">100 <img src="assets/coin.png" alt="coins" class="coin-icon"></div>
            </div>
        </div>

        <!-- Nieuwe healing sectie -->
        <div class="shop-category" style="margin-top: 2rem;">Koning Support</div>
        <div class="shop-item healing" onclick="buyHealing()" style="margin-top: 1rem;">
            <div style="width: 40px; height: 40px; background-color: rgba(46, 204, 113, 0.2); position: relative; border: 2px solid #2ecc71; display: flex; justify-content: center; align-items: center;">
                <span style="color: #2ecc71; font-size: 1.5rem;">+</span>
            </div>
            <div>
                <div>Genezing</div>
                <div style="font-size: 0.8rem; display: flex; align-items: center;">30 <img src="assets/coin.png" alt="coins" class="coin-icon"></div>
            </div>
        </div>

        <!-- Voeg deze nieuwe sectie toe in de shop-sidebar, na de Koning Support sectie -->
        <div class="shop-category" style="margin-top: 2rem;">Specials</div>
        <div class="shop-item boost" onclick="buyCannonBoost()" style="margin-top: 1rem;">
            <div style="width: 40px; height: 40px; background-color: rgba(155, 89, 182, 0.2); position: relative; border: 2px solid #9b59b6; display: flex; justify-content: center; align-items: center;">
                <span style="color: #9b59b6; font-size: 1.5rem;">↑</span>
            </div>
            <div>
                <div>Kanon Boost</div>
                <div style="font-size: 0.8rem; display: flex; align-items: center;">150 <img src="assets/coin.png" alt="coins" class="coin-icon"></div>
            </div>
        </div>
    </div>
    <div class="cannon-preview">
        <div class="cannon-radius"></div>
    </div>

    <!-- Voeg deze audio tags toe in de HTML -->
    <audio id="gunshotSound" src="assets/gunshot.mp3" preload="auto"></audio>
    <audio id="bonusSound" src="assets/game-bonus.mp3" preload="auto"></audio>
    <audio id="wrongSound" src="assets/wrong.mp3" preload="auto"></audio>
    <audio id="purchaseSound" src="assets/aankoop.mp3" preload="auto"></audio>

    <div class="tooltip" style="display: none;">
        <div class="tooltip-title">Kanon Stats</div>
        <div class="tooltip-stat">
            <span>Schade:</span>
            <span>2 per schot</span>
        </div>
        <div class="tooltip-stat">
            <span>Vuursnelheid:</span>
            <span>0.8s</span>
        </div>
        <div class="tooltip-stat">
            <span>Bereik:</span>
            <span>100px</span>
        </div>
        <div class="tooltip-stat">
            <span>Duurzaamheid:</span>
            <span>5 schoten</span>
        </div>
        <div class="tooltip-stat">
            <span>Kosten:</span>
            <span>50 <img src="assets/coin.png" alt="coins" class="coin-icon"></span>
        </div>
    </div>

    <div id="instructionsModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <button class="close-button" onclick="closeInstructions()">×</button>
            <h2 class="title" style="font-size: 1.5rem;">Instructies</h2>
            
            <div style="color: #FFD700; text-align: left; font-size: 0.8rem; line-height: 1.5;">
                <!-- Voeg deze nieuwe sectie toe bovenaan -->
                <div style="background-color: rgba(46, 204, 113, 0.2); padding: 1rem; border: 2px solid #2ecc71; margin-bottom: 1rem; border-radius: 5px;">
                    <span style="color: #2ecc71;">Tip:</span> Druk op F11 voor de beste spelervaring in volledig scherm!
                </div>

                <h3 style="margin: 1rem 0; font-size: 1rem;">Doel van het spel</h3>
                <p>Bescherm de Aardappel Koning tegen de aanvallende vijanden! Plaats kanonnen strategisch om de vijanden tegen te houden voordat ze de koning bereiken.</p>
                
                <h3 style="margin: 1rem 0; font-size: 1rem;">Hoe speel je</h3>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin: 0.5rem 0;">• Koop kanonnen uit de shop (rechts)</li>
                    <li style="margin: 0.5rem 0;">• Plaats kanonnen langs het pad (niet op het pad)</li>
                    <li style="margin: 0.5rem 0;">• Start de wave wanneer je klaar bent</li>
                    <li style="margin: 0.5rem 0;">• Verdien munten voor elke verslagen vijand</li>
                    <li style="margin: 0.5rem 0;">• Ontvang een bonus na elke wave</li>
                </ul>

                <h3 style="margin: 1rem 0; font-size: 1rem;">Kanonnen</h3>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin: 0.5rem 0;">• Kanonnen hebben beperkte duurzaamheid</li>
                    <li style="margin: 0.5rem 0;">• Kapotte kanonnen kunnen herbouwd worden</li>
                    <li style="margin: 0.5rem 0;">• Kanonnen schieten automatisch op vijanden binnen bereik</li>
                </ul>

                <h3 style="margin: 1rem 0; font-size: 1rem;">Koning Support</h3>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin: 0.5rem 0;">• Koop genezing om de koning te helen (+10 HP)</li>
                    <li style="margin: 0.5rem 0;">• Genezing is beschikbaar tijdens waves</li>
                    <li style="margin: 0.5rem 0;">• Genezing is uitgeschakeld bij volle gezondheid</li>
                </ul>

                <h3 style="margin: 1rem 0; font-size: 1rem;">Bonus Munten</h3>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin: 0.5rem 0;">• Beantwoord kennisvragen voor extra munten</li>
                    <li style="margin: 0.5rem 0;">• Maximaal 3 vragen per wave</li>
                    <li style="margin: 0.5rem 0;">• Verdien 10 munten per goed antwoord</li>
                    <li style="margin: 0.5rem 0;">• Vragen worden gereset na elke wave</li>
                </ul>

                <h3 style="margin: 1rem 0; font-size: 1rem;">Waves</h3>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin: 0.5rem 0;">• Elke wave wordt moeilijker</li>
                    <li style="margin: 0.5rem 0;">• Vijanden worden sterker per wave</li>
                    <li style="margin: 0.5rem 0;">• Je verliest als de koning geen HP meer heeft</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="bonusCoinModal" class="modal">
        <div class="modal-content">
            <h2 class="title" style="font-size: 1.5rem;">Bonus Munten</h2>
            <div class="trivia-question">
                Wat is de hoofdstad van Nederland?
            </div>
            <div class="trivia-answers">
                <button class="answer-button" onclick="checkAnswer(this, 'Amsterdam')">Amsterdam</button>
                <button class="answer-button" onclick="checkAnswer(this, 'Den Haag')">Den Haag</button>
                <button class="answer-button" onclick="checkAnswer(this, 'Rotterdam')">Rotterdam</button>
                <button class="answer-button" onclick="checkAnswer(this, 'Utrecht')">Utrecht</button>
            </div>
        </div>
    </div>

    <!-- Update de bonus coin button HTML -->
    <button class="bonus-coin-button" onclick="showTriviaQuestion()">
        <span style="color: #FFD700; font-size: 1.5rem;">●</span>
        <div class="bonus-text">
            <div class="bonus-title">Trivia Vraag</div>
            <div class="bonus-subtitle">Beantwoord voor +10 munten!</div>
        </div>
    </button>

    <!-- Voeg dit toe aan de game-view div -->
    <button class="bonus-coin-button" onclick="showTriviaQuestion()">
        <span style="color: #FFD700; font-size: 1.5rem;">●</span>
        <span>+</span>
    </button>

    <!-- Voeg dit toe aan het einde van de body -->
    <div id="triviaModal" class="modal">
        <div class="modal-content">
            <h2 class="title" style="font-size: 1.5rem;">Verdien Munten!</h2>
            <div class="trivia-question"></div>
            <div class="trivia-answers"></div>
        </div>
    </div>

    <script>
        let soundEnabled = true;
        const modal = document.getElementById('settingsModal');
        const soundButton = document.getElementById('soundButton');

        // Maak deze variabelen globaal bovenaan het script
        let currentWave = 1;
        let isWaveInProgress = false;
        let enemiesKilled = 0;
        let enemiesFinished = 0;
        let waveConfig = null;
        let kingHealth = 100;
        const ENEMY_DAMAGE = 15; // Schade die vijanden doen aan de koning
        const ENEMY_HP = 10;     // HP van de vijanden
        const CANNON_DAMAGE = 4; // Schade van het kanon

        // Voeg deze constanten toe aan het begin van het script waar de andere constanten staan
        const STARTING_COINS = 200; // Veranderd van 200 naar 1000
        const CANNON_COST = 50;
        const COINS_PER_KILL = 15;
        const WAVE_BONUS = 50; // Voeg deze constante toe bij de andere constanten
        const CANNON_DURABILITY = 5;
        const CANNON_REBUILD_COST = 30;
        const DOUBLE_CANNON_COST = 100;
        const DOUBLE_CANNON_DAMAGE = 5; // Verhoogd van 2 naar 5
        const DOUBLE_CANNON_DURABILITY = 8;
        const DOUBLE_CANNON_REBUILD_COST = 50;
        const DOUBLE_CANNON_FIRE_RATE = 400; // Verlaagd van 800 naar 400 (0.4 seconden)

        // Voeg deze variabele toe bij de andere globale variabelen
        let playerCoins = STARTING_COINS;

        // Voeg deze constanten toe
        const HEALING_COST = 30;
        const HEALING_AMOUNT = 10;

        // Voeg deze constanten toe bovenaan het script
        const MAX_TRIVIA_QUESTIONS = 3;
        const TRIVIA_RESET_WAVE = 1;

        // Voeg deze constanten toe
        const BOOST_COST = 150;
        const BOOST_MULTIPLIER = 2; // Verander van 1.1 naar 2 voor een verdubbeling

        // Voeg deze functie toe
        function updateBoostButtonStatus() {
            const boostItem = document.querySelector('.shop-item.boost');
            const activeCannons = document.querySelectorAll('.placed-cannon, .placed-double-cannon');
            
            if (boostItem) {
                if (activeCannons.length === 0 || playerCoins < BOOST_COST) {
                    boostItem.classList.add('disabled');
                    boostItem.style.cursor = 'not-allowed';
                    boostItem.onclick = null;
                } else {
                    boostItem.classList.remove('disabled');
                    boostItem.style.cursor = 'pointer';
                    boostItem.onclick = buyCannonBoost;
                }
            }
        }

        // Update de startGame functie
        function startGame() {
            document.querySelector('.game-container').style.display = 'none';
            document.getElementById('gameView').style.display = 'block';
            document.querySelector('.shop-toggle').style.display = 'block';
            document.querySelector('.bonus-coin-button').style.display = 'flex';
            updateTriviaBonusButton();
            updateCoins(0);
            updateBoostButtonStatus(); // Voeg deze regel toe
        }

        function showInstructions() {
            document.getElementById('instructionsModal').style.display = "flex";
        }

        function closeInstructions() {
            document.getElementById('instructionsModal').style.display = "none";
        }

        function showSettings() {
            modal.style.display = "flex";
        }

        function closeSettings() {
            modal.style.display = "none";
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            soundButton.textContent = soundEnabled ? "AAN" : "UIT";
        }

        // Sluit modal als er buiten wordt geklikt
        window.onclick = function(event) {
            if (event.target == modal) {
                closeSettings();
            }
        }

        const waveStatus = document.getElementById('waveStatus');

        // Update de getWaveConfig functie
        function getWaveConfig(waveNumber) {
            // Basis configuratie
            const baseEnemies = 5;
            const baseSpeed = 10;
            const baseHP = ENEMY_HP; // Standaard HP van vijanden
            
            // Bereken scaling voor deze wave
            const enemyCount = Math.min(baseEnemies + Math.floor(waveNumber * 1.5), 15); // Max 15 vijanden
            const enemySpeed = Math.max(baseSpeed - (waveNumber * 0.3), 5); // Minimum snelheid van 5
            const enemyHP = Math.floor(baseHP + (waveNumber * 2)); // HP verhoogt met 2 per wave
            
            return {
                enemies: enemyCount,
                speed: enemySpeed,
                hp: enemyHP
            };
        }

        function updateWaveNumber() {
            document.getElementById('waveNumber').textContent = currentWave;
        }

        function updateWaveStatus(status) {
            waveStatus.textContent = status;
        }

        // Update de updateKingHealth functie
        function updateKingHealth() {
            const fillElement = document.querySelector('.king-hp-fill');
            const percentage = (kingHealth / 100) * 100;
            fillElement.style.width = percentage + '%';
            
            // Update of maak de numerieke waarde
            let hpNumbers = document.querySelector('.king-hp-numbers');
            if (!hpNumbers) {
                hpNumbers = document.createElement('div');
                hpNumbers.className = 'king-hp-numbers';
                document.querySelector('.king-hp-bar').appendChild(hpNumbers);
            }
            hpNumbers.textContent = `${kingHealth}/100 HP`;
            
            // Verander kleur gebaseerd op HP percentage
            if (percentage > 60) {
                fillElement.style.backgroundColor = '#2ecc71';
            } else if (percentage > 30) {
                fillElement.style.backgroundColor = '#f1c40f';
            } else {
                fillElement.style.backgroundColor = '#e74c3c';
            }

            updateHealingItemStatus();
        }

        // Voeg deze nieuwe functie toe
        function updateHealingItemStatus() {
            const healingItem = document.querySelector('.shop-item.healing');
            if (healingItem) {
                if (kingHealth >= 100 || playerCoins < HEALING_COST) {
                    healingItem.classList.add('disabled');
                    healingItem.style.cursor = 'not-allowed';
                    healingItem.onclick = null;
                } else {
                    healingItem.classList.remove('disabled');
                    healingItem.style.cursor = 'pointer';
                    healingItem.onclick = buyHealing;
                }
                }
            }

        // Update de updateCoins functie
        function updateCoins(amount) {
            if (amount < 0 && soundEnabled) {
                const purchaseSound = document.getElementById('purchaseSound');
                purchaseSound.currentTime = 0;
                purchaseSound.play().catch(error => console.log("Audio afspelen mislukt:", error));
            }
            
            playerCoins += amount;
            document.getElementById('coinDisplay').textContent = playerCoins;
            
            // Update shop items based on available coins
            document.querySelectorAll('.shop-item').forEach((item) => {
                if (item.classList.contains('healing')) {
                    updateHealingItemStatus();
                } else if (item.classList.contains('boost')) {
                    updateBoostButtonStatus();
                } else {
                    const cost = item === document.querySelectorAll('.shop-item')[0] ? CANNON_COST : DOUBLE_CANNON_COST;
                    if (playerCoins < cost) {
                        item.classList.add('disabled');
                    } else {
                        item.classList.remove('disabled');
                    }
                }
            });
        }

        // Update de startWave functie om de nieuwe HP te gebruiken
        function startWave() {
            if (isWaveInProgress) return;
            
            const activeCannons = document.querySelectorAll('.placed-cannon, .placed-double-cannon');
            if (activeCannons.length === 0) {
                return;
            }
            
            console.log(`Wave ${currentWave} gestart!`);
            isWaveInProgress = true;
            updateWaveStatus("Wave in progress...");
            
            updateShopDuringWave(true);
            
            const waveButton = document.querySelector('.wave-button');
            waveButton.classList.add('disabled');
            
            waveConfig = getWaveConfig(currentWave);
            enemiesKilled = 0;
            enemiesFinished = 0;
            let enemyCount = 0;
            
            const spawnInterval = setInterval(() => {
                if (enemyCount >= waveConfig.enemies) {
                    clearInterval(spawnInterval);
                    return;
                }
                
                const enemy = document.createElement('div');
                enemy.className = 'enemy';
                enemy.style.animation = `followPath ${waveConfig.speed}s linear`;
                enemy.dataset.health = waveConfig.hp;

                // Maak eerst de enemy image
                const enemyImg = document.createElement('img');
                enemyImg.src = 'assets/patato-knight.png';
                enemyImg.alt = 'Enemy';
                enemy.appendChild(enemyImg); // Voeg de image eerst toe

                // Daarna de HP bar
                const hpBar = document.createElement('div');
                hpBar.className = 'hp-bar';
                const hpFill = document.createElement('div');
                hpFill.className = 'hp-fill';
                hpFill.style.width = '100%';
                
                // Voeg numerieke waarde toe
                const hpNumbers = document.createElement('div');
                hpNumbers.className = 'hp-numbers';
                hpNumbers.textContent = `${waveConfig.hp}/${waveConfig.hp}`;
                
                hpBar.appendChild(hpFill);
                hpBar.appendChild(hpNumbers);
                enemy.appendChild(hpBar); // Voeg de HP bar als laatste toe
                
                document.querySelector('.game-map').appendChild(enemy);
                
                enemy.addEventListener('animationend', () => {
                    enemy.remove();
                    enemiesFinished++;
                    kingHealth -= ENEMY_DAMAGE;
                    updateKingHealth();
                    
                    if (kingHealth <= 0) {
                        showGameOver();
                        return;
                    }
                    
                    if (enemiesKilled + enemiesFinished === waveConfig.enemies) {
                        endWave();
                    }
                });

                enemyCount++;
            }, 1000);
        }

        // Voeg deze nieuwe functie toe
        function updateShopDuringWave(isWaveActive) {
            const combatItems = document.querySelectorAll('.shop-item:not(.healing)');
            combatItems.forEach(item => {
                if (isWaveActive) {
                    item.classList.add('disabled');
                    item.style.cursor = 'not-allowed';
                    // Bewaar de originele onclick handler
                    item.dataset.originalOnclick = item.getAttribute('onclick');
                    item.removeAttribute('onclick');
                } else {
                    item.classList.remove('disabled');
                    item.style.cursor = 'pointer';
                    // Herstel de originele onclick handler
                    if (item.dataset.originalOnclick) {
                        item.setAttribute('onclick', item.dataset.originalOnclick);
                    }
                }
            });
        }

        // Initialiseer wave status
        updateWaveStatus("Klaar om te starten");

        function buyTower(type) {
            console.log(`Toren gekocht: ${type}`);
        }

        const waveCompletionModal = document.getElementById('waveCompletionModal');
        const completedWaveNumber = document.getElementById('completedWaveNumber');

        function showWaveCompletion(waveNumber) {
            completedWaveNumber.textContent = waveNumber;
            document.getElementById('enemiesDefeatedStat').textContent = enemiesKilled;
            document.getElementById('enemiesLeakedStat').textContent = enemiesFinished;
            document.getElementById('kingHealthStat').textContent = kingHealth;
            document.getElementById('coinsEarnedStat').textContent = enemiesKilled * COINS_PER_KILL;
            document.getElementById('waveBonusStat').textContent = WAVE_BONUS;
            
            // Voeg de wave bonus toe aan de coins
            updateCoins(WAVE_BONUS);
            
            waveCompletionModal.style.display = "flex";
        }

        function closeWaveCompletion() {
            waveCompletionModal.style.display = "none";
            const waveButton = document.querySelector('.wave-button');
            waveButton.classList.remove('disabled');
            
            // Verwijder de check voor wave 4 en de recursieve aanroep
                if (kingHealth > 0) {
                updateWaveStatus("Klaar om te starten");
                }
            }

        let isShopOpen = false;
        let selectedTower = null;
        let canPlaceTower = true;
        const preview = document.querySelector('.cannon-preview');
        const gameMap = document.querySelector('.game-map');

        // Update de toggleShop functie
        function toggleShop() {
            isShopOpen = !isShopOpen;
            document.querySelector('.shop-sidebar').classList.toggle('open');
            const toggleButton = document.querySelector('.shop-toggle');
            toggleButton.textContent = isShopOpen ? '▶' : '◀';
            toggleButton.classList.toggle('open'); // Toggle de 'open' class
        }

        // Voeg deze functie toe
        function cancelPlacement() {
            if (selectedTower) {
                selectedTower = null;
                preview.style.display = 'none';
                gameMap.removeEventListener('mousemove', movePreview);
                gameMap.removeEventListener('click', placeCannon);
                document.querySelectorAll('.inventory-slot, .shop-item').forEach(item => {
                    item.classList.remove('selected');
                });
            }
        }

        // Update de event listeners
        function selectCannon(type) {
            const cost = type === 'double' ? DOUBLE_CANNON_COST : CANNON_COST;
            if (playerCoins < cost) return;
            
            selectedTower = type;
            preview.style.display = 'block';
            preview.className = `cannon-preview ${type}`;
            
            // Stel verschillende radius groottes in voor verschillende kanonnen
            const radiusSize = type === 'double' ? '160px' : '240px';
            
            preview.innerHTML = `
                <div class="cannon-radius" style="--radius-size: ${radiusSize};"></div>
                <div class="preview-cannon">
                    ${type === 'double' ? `
                        <div class="preview-barrel top"></div>
                        <div class="preview-barrel bottom"></div>
                    ` : `
                        <div class="preview-barrel"></div>
                    `}
                </div>
            `;
            
            document.querySelectorAll('.shop-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Voeg event listeners toe
            gameMap.addEventListener('mousemove', movePreview);
            gameMap.addEventListener('click', placeCannon);
            gameMap.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                cancelPlacement();
            });
            
            // Voeg keyboard listener toe
            document.addEventListener('keydown', handleKeyPress);
        }

        // Voeg deze functie toe voor keyboard events
        function handleKeyPress(e) {
            if (e.key === 'Escape' && selectedTower) {
                cancelPlacement();
                document.removeEventListener('keydown', handleKeyPress);
            }
        }

        function movePreview(e) {
            if (!selectedTower) return;
            
            const rect = gameMap.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Centreer de preview op de muis
            preview.style.left = x + 'px';
            preview.style.top = y + 'px';

            // Check of we op het pad zijn
            const paths = document.querySelectorAll('.path, .path-curve');
            canPlaceTower = true;

            // Check voor overlap met pad
            paths.forEach(path => {
                const pathRect = path.getBoundingClientRect();
                if (e.clientX >= pathRect.left && e.clientX <= pathRect.right &&
                    e.clientY >= pathRect.top && e.clientY <= pathRect.bottom) {
                    canPlaceTower = false;
                }
            });

            // Check voor overlap met andere kanonnen
            const cannons = document.querySelectorAll('.placed-cannon, .placed-double-cannon');
            cannons.forEach(cannon => {
                const cannonRect = cannon.getBoundingClientRect();
                const distance = Math.sqrt(
                    Math.pow((e.clientX - (cannonRect.left + cannonRect.width/2)), 2) +
                    Math.pow((e.clientY - (cannonRect.top + cannonRect.height/2)), 2)
                );
                
                if (distance < 40) {
                    canPlaceTower = false;
                }
            });

            // Update preview appearance
            if (canPlaceTower) {
                preview.classList.remove('invalid');
            } else {
                preview.classList.add('invalid');
            }
        }

        function placeCannon(e) {
            if (!selectedTower || !canPlaceTower) return;
            
            const cost = selectedTower === 'double' ? DOUBLE_CANNON_COST : CANNON_COST;
            if (playerCoins < cost) return;
            
            updateCoins(-cost);
            
            const rect = gameMap.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const cannon = document.createElement('div');
            cannon.className = selectedTower === 'double' ? 'placed-double-cannon' : 'placed-cannon';
            cannon.style.left = (x - 20) + 'px';
            cannon.style.top = (y - 10) + 'px';
            
            // Stel de initiële waarden correct in
            const baseDurability = selectedTower === 'double' ? DOUBLE_CANNON_DURABILITY : CANNON_DURABILITY;
            cannon.dataset.maxDurability = baseDurability.toString(); // Zorg ervoor dat het een string is
            cannon.dataset.durability = baseDurability.toString(); // Zorg ervoor dat het een string is
            cannon.dataset.type = selectedTower;

            // Add HP bar
            const hpBar = document.createElement('div');
            hpBar.className = 'hp-bar';
            const hpFill = document.createElement('div');
            hpFill.className = 'hp-fill';
            hpFill.style.width = '100%';
            
            // Voeg numerieke waarde toe met correcte initiële waarden
            const hpNumbers = document.createElement('div');
            hpNumbers.className = 'hp-numbers';
            hpNumbers.textContent = `${baseDurability}/${baseDurability}`;
            
            hpBar.appendChild(hpFill);
            hpBar.appendChild(hpNumbers);
            cannon.appendChild(hpBar);

            // Add barrel(s)
            if (selectedTower === 'double') {
                const topBarrel = document.createElement('div');
                topBarrel.className = 'double-cannon-barrel top';
                const bottomBarrel = document.createElement('div');
                bottomBarrel.className = 'double-cannon-barrel bottom';
                cannon.appendChild(topBarrel);
                cannon.appendChild(bottomBarrel);
            } else {
                const barrel = document.createElement('div');
                barrel.className = 'cannon-barrel';
                cannon.appendChild(barrel);
            }

            // Richt het kanon initieel naar het pad
            const paths = document.querySelectorAll('.path, .path-curve');
            let closestPoint = null;
            let minDistance = Infinity;

            paths.forEach(path => {
                const pathRect = path.getBoundingClientRect();
                const pathCenterX = pathRect.left + pathRect.width / 2;
                const pathCenterY = pathRect.top + pathRect.height / 2;
                
                const distance = Math.sqrt(
                    Math.pow(pathCenterX - e.clientX, 2) +
                    Math.pow(pathCenterY - e.clientY, 2)
                );
                
                if (distance < minDistance) {
                    minDistance = distance;
                    closestPoint = { x: pathCenterX, y: pathCenterY };
                }
            });

            if (closestPoint) {
                const angle = Math.atan2(
                    closestPoint.y - e.clientY,
                    closestPoint.x - e.clientX
                );
                cannon.style.transform = `rotate(${angle}rad)`;
            }

            // Voeg kanon logica toe
            cannon.canShoot = true;  // Zet canShoot op het cannon object
            const radius = 100;

            function checkTargets() {
                if (!isWaveInProgress || !cannon.isConnected) return;

                const cannonRect = cannon.getBoundingClientRect();
                const cannonCenterX = cannonRect.left + cannonRect.width / 2;
                const cannonCenterY = cannonRect.top + cannonRect.height / 2;
                const radius = cannon.dataset.type === 'double' ? 80 : 120; // Verschillende radius per type

                const enemies = document.querySelectorAll('.enemy');
                for (const enemy of enemies) {
                    if (!enemy.isConnected) continue;

                    const enemyRect = enemy.getBoundingClientRect();
                    const enemyCenterX = enemyRect.left + enemyRect.width / 2;
                    const enemyCenterY = enemyRect.top + enemyRect.height / 2;

                    const distance = Math.sqrt(
                        Math.pow(enemyCenterX - cannonCenterX, 2) +
                        Math.pow(enemyCenterY - cannonCenterY, 2)
                    );

                    if (distance <= radius && cannon.canShoot) {
                        const angle = Math.atan2(
                            enemyCenterY - cannonCenterY,
                            enemyCenterX - cannonCenterX
                        );
                        cannon.style.transform = `rotate(${angle}rad)`;
                        shoot(enemy, cannonCenterX, cannonCenterY, enemyCenterX, enemyCenterY);
                        break; // Stop na het vinden van het eerste doel
                    }
                }
            }

            // Voeg de shoot functie hier toe, binnen placeCannon
            function shoot(target, startX, startY, targetX, targetY) {
                if (!cannon.canShoot || !target || !target.isConnected) return;
                
                cannon.canShoot = false;

                // Verminder duurzaamheid
                let durability = parseFloat(cannon.dataset.durability) - 1;
                cannon.dataset.durability = durability;
                
                // Update duurzaamheid bar en numerieke waarde
                const hpFill = cannon.querySelector('.hp-fill');
                const hpNumbers = cannon.querySelector('.hp-numbers');
                const maxDurability = parseInt(cannon.dataset.maxDurability);
                const percentage = (durability / maxDurability) * 100;
                
                hpFill.style.width = percentage + '%';
                hpNumbers.textContent = `${Math.ceil(durability)}/${maxDurability}`;
                
                // Verander kleur gebaseerd op duurzaamheid
                if (percentage > 60) {
                    hpFill.style.backgroundColor = '#2ecc71';
                } else if (percentage > 30) {
                    hpFill.style.backgroundColor = '#f1c40f';
                } else {
                    hpFill.style.backgroundColor = '#e74c3c';
                }
                
                // Verwijder kanon als duurzaamheid op is en maak een kapot kanon
                if (durability <= 0) {
                    clearInterval(cannon.checkInterval);
                    
                    // Voeg explosie effect toe
                    createExplosion(cannon);
                    
                    // Verwijder het kanon
                    cannon.remove();
                    return;
                }

                // Speel het schiet geluid af als geluid aan staat
                if (soundEnabled) {
                    const gunshot = document.getElementById('gunshotSound');
                    gunshot.currentTime = 0;
                    gunshot.play().catch(error => console.log("Audio afspelen mislukt:", error));
                }

                // Voeg recoil animatie toe
                const currentRotation = cannon.style.transform;
                cannon.style.setProperty('--rotation', currentRotation);
                cannon.classList.add('shooting');
                
                // Voeg muzzle flash toe
                const flash = document.createElement('div');
                flash.className = 'muzzle-flash';
                cannon.appendChild(flash);
                flash.style.animation = 'flash 0.15s ease-out';
                
                // Verwijder flash na animatie
                setTimeout(() => {
                    flash.remove();
                    cannon.classList.remove('shooting');
                }, 150);

                // Maak en schiet kogel
                const bullet = document.createElement('div');
                bullet.className = 'bullet';
                bullet.style.left = startX + 'px';
                bullet.style.top = startY + 'px';
                bullet.style.setProperty('--targetX', `${targetX - startX}px`);
                bullet.style.setProperty('--targetY', `${targetY - startY}px`);
                
                document.body.appendChild(bullet);
                bullet.style.animation = 'shoot 0.2s linear forwards';

                bullet.addEventListener('animationend', () => {
                    if (target.isConnected) {
                        // Gebruik de damage waarde uit de dataset (die wordt geboost door de boost functie)
                        const damage = parseInt(cannon.dataset.damage || (cannon.dataset.type === 'double' ? DOUBLE_CANNON_DAMAGE : CANNON_DAMAGE));
                        let enemyHealth = parseInt(target.dataset.health) - damage;
                        target.dataset.health = enemyHealth;
                        
                        // Update vijand HP bar met numerieke waarde
                        const hpFill = target.querySelector('.hp-fill');
                        const hpNumbers = target.querySelector('.hp-numbers');
                        const maxHP = waveConfig.hp;
                        const percentage = (enemyHealth / maxHP) * 100;
                        
                        hpFill.style.width = percentage + '%';
                        hpNumbers.textContent = `${Math.max(0, enemyHealth)}/${maxHP}`;
                        
                        // Verander kleur gebaseerd op HP percentage
                        if (percentage > 60) {
                            hpFill.style.backgroundColor = '#2ecc71';
                        } else if (percentage > 30) {
                            hpFill.style.backgroundColor = '#f1c40f';
                        } else {
                            hpFill.style.backgroundColor = '#e74c3c';
                        }
                        
                        // Check of de vijand dood is
                        if (enemyHealth <= 0) {
                            target.remove(); // Verwijder de vijand
                            enemiesKilled++;
                            updateCoins(COINS_PER_KILL);
                            
                            if (enemiesKilled + enemiesFinished === waveConfig.enemies) {
                                endWave();
                            }
                        }
                    }
                    bullet.remove();
                });

                // Gebruik de gebooste fire rate
                setTimeout(() => {
                    if (cannon.isConnected) {
                        cannon.canShoot = true;
                    }
                }, 800);
            }

            // Start het interval en sla de interval ID op op het cannon object
            cannon.checkInterval = setInterval(checkTargets, 100);

            gameMap.appendChild(cannon);
            updateBoostButtonStatus(); // Voeg deze regel toe

            // Reset selectie
            selectedTower = null;
            preview.style.display = 'none';
            document.querySelectorAll('.shop-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            gameMap.removeEventListener('mousemove', movePreview);
            gameMap.removeEventListener('click', placeCannon);
            gameMap.removeEventListener('contextmenu', cancelPlacement);
            document.removeEventListener('keydown', handleKeyPress);
        }

        // Update de endWave functie om oneindige waves te ondersteunen
        function endWave() {
            isWaveInProgress = false;
            document.querySelector('.shop-toggle').classList.remove('disabled');
            updateShopDuringWave(false);
            
            // Reset trivia vragen na een wave
            localStorage.setItem('triviaQuestionsAsked', '0');
            updateTriviaBonusButton();
            
            // Reset alle gebooste kanonnen naar originele stats
            document.querySelectorAll('.placed-cannon, .placed-double-cannon').forEach(cannon => {
                if (cannon.dataset.boosted === 'true') {
                    // Bereken originele waardes
                    const isDouble = cannon.dataset.type === 'double';
                    const originalDurability = isDouble ? DOUBLE_CANNON_DURABILITY : CANNON_DURABILITY;
                    const originalDamage = isDouble ? DOUBLE_CANNON_DAMAGE : CANNON_DAMAGE;
                    const originalFireRate = isDouble ? DOUBLE_CANNON_FIRE_RATE : 800;
                    
                    // Bereken proportionele duurzaamheid
                    const currentDurability = parseFloat(cannon.dataset.durability);
                    const maxDurability = parseFloat(cannon.dataset.maxDurability);
                    const durabilityPercentage = currentDurability / maxDurability;
                    const newDurability = Math.ceil(durabilityPercentage * originalDurability);
                    
                    // Reset stats
                    cannon.dataset.maxDurability = originalDurability;
                    cannon.dataset.durability = newDurability;
                    cannon.dataset.damage = originalDamage;
                    cannon.dataset.fireRate = originalFireRate;
                    cannon.dataset.boosted = 'false';
                    
                    // Update HP bar en numerieke waarde
                    const hpNumbers = cannon.querySelector('.hp-numbers');
                    hpNumbers.textContent = `${newDurability}/${originalDurability}`;
                    
                    // Update HP bar percentage
                    const hpFill = cannon.querySelector('.hp-fill');
                    const percentage = (newDurability / originalDurability) * 100;
                    hpFill.style.width = percentage + '%';
                    
                    // Update HP bar kleur
                    if (percentage > 60) {
                        hpFill.style.backgroundColor = '#2ecc71';
                    } else if (percentage > 30) {
                        hpFill.style.backgroundColor = '#f1c40f';
                    } else {
                        hpFill.style.backgroundColor = '#e74c3c';
                    }
                }
            });
            
            // Verwijder de speciale behandeling voor wave 4
                currentWave++;
                updateWaveNumber();
                showWaveCompletion(currentWave - 1);
            updateWaveStatus("Klaar om te starten");
        }

        // Initialiseer koning HP bar
        updateKingHealth();

        // Voeg deze functie toe
        function showGameOver() {
            const gameOverModal = document.getElementById('gameOverModal');
            gameOverModal.style.display = "flex";
            document.getElementById('finalWave').textContent = currentWave;
            document.getElementById('totalEnemiesDefeated').textContent = enemiesKilled;
            
            // Stop alle lopende waves en intervals
            isWaveInProgress = false;
            document.querySelectorAll('.enemy').forEach(enemy => enemy.remove());
            
            // Reset localStorage
            localStorage.removeItem('triviaQuestionsAsked');
            
            // Update UI elements
            updateTriviaBonusButton();
        }

        function resetGame() {
            // Reset alle game variabelen
            currentWave = 1;
            isWaveInProgress = false;
            enemiesKilled = 0;
            enemiesFinished = 0;
            kingHealth = STARTING_KING_HP;
            playerCoins = STARTING_COINS;
            
            // Verwijder alle kanonnen
            document.querySelectorAll('.placed-cannon').forEach(cannon => cannon.remove());
            
            // Verwijder alle vijanden
            document.querySelectorAll('.enemy').forEach(enemy => enemy.remove());
            
            // Reset UI
            updateWaveNumber();
            updateKingHealth();
            updateCoins(0);
            updateWaveStatus("Klaar om te starten");
            
            // Reset wave button
            const waveButton = document.querySelector('.wave-button');
            waveButton.classList.remove('disabled');
            
            // Reset shop
            document.querySelector('.shop-sidebar').classList.remove('open');
            document.querySelector('.shop-toggle').textContent = '◀';
            isShopOpen = false;
            
            // Reset preview
            selectedTower = null;
            preview.style.display = 'none';
            document.querySelectorAll('.shop-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Verwijder eventuele event listeners
            gameMap.removeEventListener('mousemove', movePreview);
            gameMap.removeEventListener('click', placeCannon);
            gameMap.removeEventListener('contextmenu', cancelPlacement);
            document.removeEventListener('keydown', handleKeyPress);
        }

        function backToMenu() {
            // Ververs de pagina
            location.reload();
        }

        const tooltip = document.querySelector('.tooltip');
        const shopItems = document.querySelectorAll('.shop-item');
        shopItems.forEach(item => {
            item.addEventListener('mousemove', (e) => {
                const isDouble = item === shopItems[1]; // Check of dit het dubbele kanon is
                const isHealing = item.classList.contains('healing'); // Check of dit het healing item is
                tooltip.style.display = 'block';
                tooltip.style.left = (e.pageX + 15) + 'px';
                tooltip.style.top = (e.pageY + 15) + 'px';
                
                if (isHealing) {
                    tooltip.innerHTML = `
                        <div class="tooltip-title">Genezing Stats</div>
                        <div class="tooltip-stat">
                            <span>Herstel:</span>
                            <span>${HEALING_AMOUNT} HP</span>
                        </div>
                        <div class="tooltip-stat">
                            <span>Kosten:</span>
                            <span>${HEALING_COST} <img src="assets/coin.png" alt="coins" class="coin-icon"></span>
                        </div>
                        <div class="tooltip-stat">
                            <span>Effect:</span>
                            <span>Direct</span>
                        </div>
                    `;
                } else if (isDouble) {
                    // Bestaande dubbel kanon tooltip
                    tooltip.innerHTML = `
                        <div class="tooltip-title">Dubbel Kanon Stats</div>
                        <div class="tooltip-stat">
                            <span>Schade:</span>
                            <span>${DOUBLE_CANNON_DAMAGE} per loop</span>
                        </div>
                        <div class="tooltip-stat">
                            <span>Vuursnelheid:</span>
                            <span>0.4s</span>
                        </div>
                        <div class="tooltip-stat">
                            <span>Bereik:</span>
                            <span>80px</span>
                        </div>
                        <div class="tooltip-stat">
                            <span>Duurzaamheid:</span>
                            <span>${DOUBLE_CANNON_DURABILITY} schoten</span>
                        </div>
                        <div class="tooltip-stat">
                            <span>Kosten:</span>
                            <span>${DOUBLE_CANNON_COST} <img src="assets/coin.png" alt="coins" class="coin-icon"></span>
                        </div>
                    `;
                } else {
                    // Bestaande enkel kanon tooltip
                    tooltip.innerHTML = `
                        <div class="tooltip-title">Kanon Stats</div>
                        <div class="tooltip-stat">
                            <span>Schade:</span>
                            <span>${CANNON_DAMAGE} per schot</span>
                        </div>
                        <div class="tooltip-stat">
                            <span>Vuursnelheid:</span>
                            <span>0.8s</span>
                        </div>
                        <div class="tooltip-stat">
                            <span>Bereik:</span>
                            <span>120px</span>
                        </div>
                        <div class="tooltip-stat">
                            <span>Duurzaamheid:</span>
                            <span>${CANNON_DURABILITY} schoten</span>
                        </div>
                        <div class="tooltip-stat">
                            <span>Kosten:</span>
                            <span>${CANNON_COST} <img src="assets/coin.png" alt="coins" class="coin-icon"></span>
                        </div>
                    `;
                }
            });

            item.addEventListener('mouseleave', () => {
                tooltip.style.display = 'none';
            });
        });

        // Voeg deze functies toe voor de rebuild functionaliteit
        function showRebuildModal(brokenCannon) {
            if (isWaveInProgress) return;
            
            const isDouble = brokenCannon.dataset.type === 'double';
            const cost = isDouble ? DOUBLE_CANNON_REBUILD_COST : CANNON_REBUILD_COST;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2 class="title" style="font-size: 1.5rem;">Herbouw Kanon</h2>
                    <div style="color: #FFD700; margin: 1rem 0; text-align: center; font-size: 0.9rem;">
                        Wil je dit kanon herbouwen voor ${cost} <img src="assets/coin.png" alt="coins" class="coin-icon">?
                    </div>
                    <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 1rem;">
                        <button class="menu-button" onclick="rebuildCannon(this)" 
                            style="margin: 0; padding: 0.5rem 1rem; font-size: 1rem; min-width: 80px;">Ja</button>
                        <button class="menu-button" onclick="closeRebuildModal(this)" 
                            style="margin: 0; padding: 0.5rem 1rem; font-size: 1rem; min-width: 80px;">Nee</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.brokenCannon = brokenCannon;
        }

        function closeRebuildModal(button) {
            button.closest('.modal').remove();
        }

        function rebuildCannon(button) {
            const modal = button.closest('.modal');
            const brokenCannon = modal.brokenCannon;
            const isDouble = brokenCannon.dataset.type === 'double';
            const cost = isDouble ? DOUBLE_CANNON_REBUILD_COST : CANNON_REBUILD_COST;
            
            if (playerCoins < cost) return;
            
            // Maak nieuw kanon aan op dezelfde plek
            const cannon = document.createElement('div');
            cannon.className = isDouble ? 'placed-double-cannon' : 'placed-cannon'; // Dit was correct
            cannon.style.left = brokenCannon.style.left;
            cannon.style.top = brokenCannon.style.top;
            cannon.style.transform = brokenCannon.style.transform;
            
            // Gebruik de juiste basis waardes voor het type kanon
            const baseDurability = isDouble ? DOUBLE_CANNON_DURABILITY : CANNON_DURABILITY;
            const baseDamage = isDouble ? DOUBLE_CANNON_DAMAGE : CANNON_DAMAGE;
            const baseFireRate = isDouble ? DOUBLE_CANNON_FIRE_RATE : 800;
            
            // Sla de normale waardes op in de dataset
            cannon.dataset.maxDurability = baseDurability;
            cannon.dataset.durability = baseDurability;
            cannon.dataset.damage = baseDamage;
            cannon.dataset.fireRate = baseFireRate;
            cannon.dataset.type = isDouble ? 'double' : 'single'; // Belangrijk: sla het juiste type op
            cannon.dataset.boosted = 'false';
            cannon.canShoot = true;

            // Voeg HP bar toe
            const hpBar = document.createElement('div');
            hpBar.className = 'hp-bar';
            const hpFill = document.createElement('div');
            hpFill.className = 'hp-fill';
            hpFill.style.width = '100%';
            
            const hpNumbers = document.createElement('div');
            hpNumbers.className = 'hp-numbers';
            hpNumbers.textContent = `${baseDurability}/${baseDurability}`;
            
            hpBar.appendChild(hpFill);
            hpBar.appendChild(hpNumbers);
            cannon.appendChild(hpBar);

            // Voeg de juiste barrels toe gebaseerd op het type
            if (isDouble) {
                const topBarrel = document.createElement('div');
                topBarrel.className = 'double-cannon-barrel top';
                const bottomBarrel = document.createElement('div');
                bottomBarrel.className = 'double-cannon-barrel bottom';
                cannon.appendChild(topBarrel);
                cannon.appendChild(bottomBarrel);
            } else {
                const barrel = document.createElement('div');
                barrel.className = 'cannon-barrel';
                cannon.appendChild(barrel);
            }

            // ... rest van de code blijft hetzelfde ...

            // Trek de juiste kosten af
            updateCoins(-cost); // Gebruik de cost variabele die we eerder hebben bepaald

            // Verwijder kapot kanon en plaats nieuw kanon
            brokenCannon.remove();
            gameMap.appendChild(cannon);
            
            // Sluit modal
            modal.remove();
        }

        function showWarningTooltip(message) {
            // Verwijder bestaande warning tooltips
            removeWarningTooltip();
            
            const tooltip = document.createElement('div');
            tooltip.className = 'warning-tooltip';
            tooltip.textContent = message;
            document.body.appendChild(tooltip);
            
            // Update positie bij muisbeweging
            function updatePosition(e) {
                tooltip.style.left = (e.pageX + 15) + 'px';
                tooltip.style.top = (e.pageY + 15) + 'px';
            }
            
            document.addEventListener('mousemove', updatePosition);
            
            // Verwijder tooltip na 2 seconden
            setTimeout(() => {
                document.removeEventListener('mousemove', updatePosition);
                removeWarningTooltip();
            }, 2000);
        }

        function removeWarningTooltip() {
            const existingTooltip = document.querySelector('.warning-tooltip');
            if (existingTooltip) {
                existingTooltip.remove();
            }
        }

        // Voeg deze event listeners toe aan het eind van het script
        const waveButton = document.querySelector('.wave-button');

        // Update de wave button event listeners
        waveButton.addEventListener('mouseover', (e) => {
            const activeCannons = document.querySelectorAll('.placed-cannon, .placed-double-cannon');
            if (activeCannons.length === 0 && !isWaveInProgress) {
                showWarningTooltip('Je hebt geen actieve kanonnen!', e.pageX, e.pageY);
            }
        });

        waveButton.addEventListener('mousemove', (e) => {
            const activeCannons = document.querySelectorAll('.placed-cannon, .placed-double-cannon');
            if (activeCannons.length === 0 && !isWaveInProgress) {
                const warningTooltip = document.querySelector('.warning-tooltip');
                if (warningTooltip) {
                    warningTooltip.style.left = (e.pageX + 15) + 'px';
                    warningTooltip.style.top = (e.pageY + 15) + 'px';
                }
            }
        });

        waveButton.addEventListener('mouseout', () => {
            removeWarningTooltip();
        });

        // Voeg deze functie toe
        function buyHealing() {
            const healingItem = document.querySelector('.shop-item.healing');
            if (healingItem.classList.contains('disabled')) return; // Check of item disabled is
            if (kingHealth >= 100) return; // Kan niet kopen als koning volle gezondheid heeft
            if (playerCoins < HEALING_COST) return; // Kan niet kopen als niet genoeg munten

            updateCoins(-HEALING_COST);
            kingHealth = Math.min(100, kingHealth + HEALING_AMOUNT); // Voorkom dat health boven 100 gaat
            updateKingHealth();
        }

        // Voeg deze functie toe voor het tonen van de reden waarom een item disabled is
        function showDisabledReason(item, event) {
            let reason = '';
            
            // Verwijder de healing check en toon alleen waarschuwingen voor niet-healing items
            if (!item.classList.contains('healing')) {
                if (isWaveInProgress) {
                reason = 'Kan geen kanonnen kopen tijdens een wave';
                } else if (playerCoins < getItemCost(item)) {
                reason = 'Niet genoeg munten';
            }

            if (reason) {
                showWarningTooltip(reason, event.pageX, event.pageY);
                }
            }
        }

        // Helper functie om de kosten van een item te bepalen
        function getItemCost(item) {
            if (item.classList.contains('healing')) return HEALING_COST;
            if (item.querySelector('.shop-item-name').textContent.includes('Dubbel')) return DOUBLE_CANNON_COST;
            return CANNON_COST;
        }

        // Update de showWarningTooltip functie
        function showWarningTooltip(message, x, y) {
            removeWarningTooltip(); // Verwijder bestaande tooltips
            
            const tooltip = document.createElement('div');
            tooltip.className = 'warning-tooltip';
            tooltip.textContent = message;
            tooltip.style.left = (x + 15) + 'px';
            tooltip.style.top = (y + 15) + 'px';
            document.body.appendChild(tooltip);
        }

        // Update de event listeners voor shop items
        shopItems.forEach(item => {
            item.addEventListener('mouseover', (e) => {
                if (item.classList.contains('disabled')) {
                    showDisabledReason(item, e);
                }
            });

            item.addEventListener('mousemove', (e) => {
                const warningTooltip = document.querySelector('.warning-tooltip');
                if (warningTooltip && item.classList.contains('disabled')) {
                    warningTooltip.style.left = (e.pageX + 15) + 'px';
                    warningTooltip.style.top = (e.pageY + 15) + 'px';
                }
            });

            item.addEventListener('mouseleave', () => {
                removeWarningTooltip();
            });
        });

        function checkAnswer(button, correctAnswer) {
            const buttons = document.querySelectorAll('.answer-button');
            buttons.forEach(btn => btn.disabled = true);
            
            if (button.textContent.trim() === correctAnswer) {
                button.classList.add('correct');
                updateCoins(10);
                
                // Speel het bonus geluid af bij goed antwoord
                if (soundEnabled) {
                    const bonusSound = document.getElementById('bonusSound');
                    bonusSound.currentTime = 0;
                    bonusSound.play().catch(error => console.log("Audio afspelen mislukt:", error));
                }
            } else {
                button.classList.add('incorrect');
                
                // Speel het foute antwoord geluid af
                if (soundEnabled) {
                    const wrongSound = document.getElementById('wrongSound');
                    wrongSound.currentTime = 0;
                    wrongSound.play().catch(error => console.log("Audio afspelen mislukt:", error));
                }
                
                buttons.forEach(btn => {
                    if (btn.textContent.trim() === correctAnswer) {
                        btn.classList.add('correct');
                    }
                });
            }
            
            setTimeout(() => {
                document.getElementById('triviaModal').style.display = 'none';
            }, 1500);
        }

        // Voeg deze functies toe
        async function showTriviaQuestion() {
            const questionsAsked = parseInt(localStorage.getItem('triviaQuestionsAsked') || '0');
            
            if (questionsAsked >= MAX_TRIVIA_QUESTIONS) {
                showWarningTooltip('Voltooi eerst een wave om meer vragen te kunnen beantwoorden', event.pageX, event.pageY);
                return;
            }

            try {
                const response = await fetch('https://opentdb.com/api.php?amount=1&type=multiple');
                const data = await response.json();
                const question = data.results[0];
                
                const triviaModal = document.getElementById('triviaModal');
                const questionElement = triviaModal.querySelector('.trivia-question');
                const answersElement = triviaModal.querySelector('.trivia-answers');
                
                // Decodeer HTML entities
                questionElement.innerHTML = decodeHtmlEntities(question.question);
                
                // Meng de antwoorden
                const answers = [
                    question.correct_answer,
                    ...question.incorrect_answers
                ].sort(() => Math.random() - 0.5);
                
                // Maak antwoord knoppen
                answersElement.innerHTML = answers.map(answer => `
                    <button class="answer-button" onclick="checkAnswer(this, '${question.correct_answer}')">
                        ${decodeHtmlEntities(answer)}
                    </button>
                `).join('');
                
                triviaModal.style.display = 'flex';
                
                // Update trivia counter
                const questionsAsked = parseInt(localStorage.getItem('triviaQuestionsAsked') || '0');
                localStorage.setItem('triviaQuestionsAsked', questionsAsked + 1);
                updateTriviaBonusButton();
                
            } catch (error) {
                console.error('Error fetching trivia:', error);
            }
        }

        function decodeHtmlEntities(text) {
            const textarea = document.createElement('textarea');
            textarea.innerHTML = text;
            return textarea.value;
        }

        // Voeg deze nieuwe functies toe
        function updateTriviaBonusButton() {
            const questionsAsked = parseInt(localStorage.getItem('triviaQuestionsAsked') || '0');
            const bonusButton = document.querySelector('.bonus-coin-button');
            
            if (questionsAsked >= MAX_TRIVIA_QUESTIONS) {
                bonusButton.classList.add('disabled');
                bonusButton.style.cursor = 'not-allowed';
                bonusButton.onclick = null;
            } else {
                bonusButton.classList.remove('disabled');
                bonusButton.style.cursor = 'pointer';
                bonusButton.onclick = showTriviaQuestion;
            }
        }

        // Voeg event listeners toe voor de bonus knop tooltip
        document.querySelector('.bonus-coin-button').addEventListener('mouseover', (e) => {
            const questionsAsked = parseInt(localStorage.getItem('triviaQuestionsAsked') || '0');
            if (questionsAsked >= MAX_TRIVIA_QUESTIONS) {
                showWarningTooltip('Voltooi eerst een wave om meer vragen te kunnen beantwoorden', e.pageX, e.pageY);
            }
        });

        document.querySelector('.bonus-coin-button').addEventListener('mouseout', () => {
            removeWarningTooltip();
        });

        // Voeg deze functie toe
        function buyCannonBoost() {
            if (playerCoins < BOOST_COST) return;
            
            const cannons = document.querySelectorAll('.placed-cannon, .placed-double-cannon');
            if (cannons.length === 0) {
                showWarningTooltip('Er zijn geen kanonnen om te boosten!');
                return;
            }
            
            updateCoins(-BOOST_COST);
            
            cannons.forEach(cannon => {
                // Markeer het kanon als geboost
                cannon.dataset.boosted = 'true';
                
                // Bereken en sla de gebooste waardes op
                const baseDurability = cannon.dataset.type === 'double' ? DOUBLE_CANNON_DURABILITY : CANNON_DURABILITY;
                const baseDamage = cannon.dataset.type === 'double' ? DOUBLE_CANNON_DAMAGE : CANNON_DAMAGE;
                const baseFireRate = cannon.dataset.type === 'double' ? DOUBLE_CANNON_FIRE_RATE : 800;
                
                // Sla de gebooste waardes op in de dataset
                cannon.dataset.maxDurability = baseDurability * BOOST_MULTIPLIER;
                cannon.dataset.durability = baseDurability * BOOST_MULTIPLIER;
                cannon.dataset.damage = baseDamage * BOOST_MULTIPLIER;
                cannon.dataset.fireRate = baseFireRate / BOOST_MULTIPLIER;

                // Update direct de HP bar met de nieuwe waardes
                const hpNumbers = cannon.querySelector('.hp-numbers');
                hpNumbers.textContent = `${Math.ceil(cannon.dataset.durability)}/${cannon.dataset.maxDurability}`;
                
                // Visueel effect voor de boost
                const boostEffect = document.createElement('div');
                boostEffect.style.cssText = `
                    position: absolute;
                    width: 100%;
                    height: 100%;
                    background: radial-gradient(circle, rgba(155, 89, 182, 0.6) 0%, transparent 70%);
                    animation: pulse 1s ease-out;
                    pointer-events: none;
                `;
                cannon.appendChild(boostEffect);
                setTimeout(() => boostEffect.remove(), 1000);
            });
        }

        // Voeg deze CSS toe voor de boost animatie
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); opacity: 0.6; }
                100% { transform: scale(2); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Update de tooltip voor het boost item
        shopItems.forEach(item => {
            item.addEventListener('mousemove', (e) => {
                if (item.classList.contains('boost')) {
                    tooltip.innerHTML = `
                        <div class="tooltip-title">Kanon Boost</div>
                        <div class="tooltip-stat">
                            <span>Effect:</span>
                            <span>Versterkt alle kanonnen</span>
                        </div>
                        <div class="tooltip-stat">
                            <span>Boost:</span>
                            <span>• Schade x2
                            <br>• Duurzaamheid x2
                            <br>• Vuursnelheid /2 (2x sneller)</span>
                        </div>
                        <div class="tooltip-stat">
                            <span>Geldt voor:</span>
                            <span>Alle geplaatste kanonnen</span>
                        </div>
                        <div class="tooltip-stat">
                            <span>Kosten:</span>
                            <span>${BOOST_COST} <img src="assets/coin.png" alt="coins" class="coin-icon"></span>
                        </div>
                    `;
                }
            });
        });

        // Update alle plekken waar de coin bullet point (●) wordt gebruikt
        // Vervang de bestaande coin displays met deze nieuwe versie

        // Update de coin display in de game UI
        document.querySelector('.coin-display').innerHTML = `
            <span id="coinDisplay">200</span> 
            <img src="assets/coin.png" alt="coins" class="coin-icon">
        `;

        // Update de wave completion stats
        document.querySelector('.wave-stats').innerHTML = `
            <div>Vijanden verslagen: <span id="enemiesDefeatedStat">0</span></div>
            <div>Vijanden doorgekomen: <span id="enemiesLeakedStat">0</span></div>
            <div>Koning HP: <span id="kingHealthStat">100</span>/100</div>
            <div>Verdiend: <span id="coinsEarnedStat">0</span> <img src="assets/coin.png" alt="coins" class="coin-icon"></div>
            <div>Wave bonus: <span id="waveBonusStat">50</span> <img src="assets/coin.png" alt="coins" class="coin-icon"></div>
        `;

        // Update de rebuild modal
        function showRebuildModal(brokenCannon) {
            if (isWaveInProgress) return;
            
            const isDouble = brokenCannon.dataset.type === 'double';
            const cost = isDouble ? DOUBLE_CANNON_REBUILD_COST : CANNON_REBUILD_COST;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2 class="title" style="font-size: 1.5rem;">Herbouw Kanon</h2>
                    <div style="color: #FFD700; margin: 1rem 0; text-align: center; font-size: 0.9rem;">
                        Wil je dit kanon herbouwen voor ${cost} <img src="assets/coin.png" alt="coins" class="coin-icon">?
                    </div>
                    <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 1rem;">
                        <button class="menu-button" onclick="rebuildCannon(this)" 
                            style="margin: 0; padding: 0.5rem 1rem; font-size: 1rem; min-width: 80px;">Ja</button>
                        <button class="menu-button" onclick="closeRebuildModal(this)" 
                            style="margin: 0; padding: 0.5rem 1rem; font-size: 1rem; min-width: 80px;">Nee</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.brokenCannon = brokenCannon;
        }

        // Voeg deze nieuwe functie toe voor de explosie animatie
        function createExplosion(cannon) {
            const rect = cannon.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // Maak explosie deeltjes
            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                particle.className = 'explosion-particle';
                particle.style.left = centerX + 'px';
                particle.style.top = centerY + 'px';
                
                // Voeg willekeurige vertraging toe voor meer dynamisch effect
                const delay = Math.random() * 0.2;
                particle.style.animation = `explosion 0.6s ease-out ${delay}s forwards`;
                
                document.body.appendChild(particle);
                
                // Verwijder het deeltje na de animatie
                particle.addEventListener('animationend', () => particle.remove());
            }
            
            // Maak rondvliegende brokstukken
            for (let i = 0; i < 8; i++) {
                const debris = document.createElement('div');
                debris.className = 'debris';
                debris.style.left = centerX + 'px';
                debris.style.top = centerY + 'px';
                
                // Bereken willekeurige richting en rotatie
                const angle = (Math.PI * 2 * i) / 8 + (Math.random() - 0.5);
                const distance = 50 + Math.random() * 30;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance - (Math.random() * 20); // Voeg wat zwaartekracht toe
                const rotation = Math.random() * 720 - 360; // Willekeurige rotatie tussen -360 en 360 graden
                
                debris.style.setProperty('--tx', `${tx}px`);
                debris.style.setProperty('--ty', `${ty}px`);
                debris.style.setProperty('--rotation', `${rotation}deg`);
                
                // Voeg willekeurige vertraging toe
                const delay = Math.random() * 0.1;
                debris.style.animation = `debris 0.8s ease-out ${delay}s forwards`;
                
                document.body.appendChild(debris);
                
                // Verwijder het brokstuk na de animatie
                debris.addEventListener('animationend', () => debris.remove());
            }
            
            // Speel een explosie geluid af als geluid aan staat
            if (soundEnabled) {
                const explosion = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAZAAAAhg==');
                explosion.volume = 0.3;
                explosion.play().catch(error => console.log("Audio afspelen mislukt:", error));
            }
        }

        // Voeg deze code toe aan het einde van het script
        function handleMouseMove(e) {
            const orbs = document.querySelectorAll('.color-orb');
            const mouseX = e.clientX;
            const mouseY = e.clientY;
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            
            // Bereken het middelpunt van het scherm
            const centerX = windowWidth / 2;
            const centerY = windowHeight / 2;
            
            orbs.forEach((orb, index) => {
                // Bereken de afstand van de muis tot het midden van het scherm
                const distanceFromCenter = Math.sqrt(
                    Math.pow(mouseX - centerX, 2) + 
                    Math.pow(mouseY - centerY, 2)
                );
                
                // Normaliseer de afstand (0-1)
                const normalizedDistance = Math.min(distanceFromCenter / (windowWidth / 2), 1);
                
                // Bereken de nieuwe positie relatief aan de muispositie
                const angleOffset = (index * (2 * Math.PI / 3)) + (Date.now() / 3000);
                const radius = 100 + (index * 50) + (normalizedDistance * 100);
                const tx = mouseX + Math.cos(angleOffset) * radius - (orb.offsetWidth / 2);
                const ty = mouseY + Math.sin(angleOffset) * radius - (orb.offsetHeight / 2);
                
                // Pas de grootte en intensiteit aan op basis van muisafstand
                const scale = 1 + (normalizedDistance * 0.2);
                const baseOpacity = 0.4 + (index * 0.1);
                const opacity = baseOpacity + (normalizedDistance * 0.2);
                
                // Pas de kleurintensiteit aan
                const baseColor = index === 0 ? '#8B4513' : 
                                 index === 1 ? '#A0522D' : '#6B4423';
                const color = adjustColorBrightness(baseColor, normalizedDistance * 30);
                
                // Pas alle eigenschappen toe met een vloeiende animatie
                orb.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
                orb.style.opacity = opacity;
                orb.style.background = color;
            });
        }

        // Helper functie om kleur helderheid aan te passen
        function adjustColorBrightness(hex, percent) {
            let r = parseInt(hex.substr(1,2), 16);
            let g = parseInt(hex.substr(3,2), 16);
            let b = parseInt(hex.substr(5,2), 16);

            r = Math.min(255, r + (r * percent / 100));
            g = Math.min(255, g + (g * percent / 100));
            b = Math.min(255, b + (b * percent / 100));

            const rr = Math.round(r).toString(16).padStart(2, '0');
            const gg = Math.round(g).toString(16).padStart(2, '0');
            const bb = Math.round(b).toString(16).padStart(2, '0');

            return `#${rr}${gg}${bb}`;
        }

        // Voeg throttling toe om de prestaties te verbeteren
        function throttle(func, limit) {
            let inThrottle;
            return function(e) {
                if (!inThrottle) {
                    func(e);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }
        

        // Update de event listener met throttling
        document.addEventListener('mousemove', throttle(handleMouseMove, 16)); // ~60fps
    </script>
</body>
</html> 